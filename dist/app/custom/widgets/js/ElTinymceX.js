!function(e,t,n){e.component("el-tinymce-x",{template:'<textarea class="tinymce-textarea" :id="id" :action="action"></textarea>',name:"tinymce",props:{busNo:String,action:String,disabled:Boolean,value:{type:String,default:""},id:String,toolbar:{type:Array,default:function(){return["removeformat undo redo |  bullist numlist | outdent indent | forecolor | fullscreen code","bold italic blockquote | h2 p | image media link | alignleft aligncenter alignright | table"]}},menubar:{default:""},height:{type:Number,required:!1,default:360}},data:function(){return{hasChange:!1,hasInit:!1,filedata:[],content:""}},watch:{value:function(e){!this.hasChange&&this.hasInit&&this.$nextTick(function(){window.tinymce.get(this.id).setContent(e)})}},mounted:function(){var s=this;window.tinymce.init({selector:"textarea#"+s.id,height:s.height,body_class:"panel-body",object_resizing:!1,toolbar:s.toolbar,menubar:s.menubar,language:"zh_CN",plugins:"advlist,autolink,code,paste,textcolor, colorpicker,fullscreen,link,lists,media,wordcount,image,imagetools,table",end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",block_formats:"普通标签=p;小标题=h2;",imagetools_cors_hosts:["wpimg.wallstcn.com","wallstreetcn.com"],media_live_embeds:!0,imagetools_toolbar:"watermark",default_link_target:"_blank",link_title:!1,images_upload_url:s.action,image_title:!0,file_picker_types:"file image media",images_upload_handler:function(e,o,l){var t,r=null;if(window.XMLHttpRequest)r=new XMLHttpRequest;else{if(!window.ActiveXObject)return void yufp.$message("你的浏览器不支持XMLHttp!","提示");r=new ActiveXObject("Microsoft.XMLHTTP")}r.withCredentials=!1;var n=yufp.service.getUrl({url:backend.adminService+s.action});r.open("POST",n),r.setRequestHeader("Authorization","Bearer "+yufp.service.getToken()),r.setRequestHeader("busNo",s.busNo),r.onload=function(){var e;if(200==r.status){var t={},n=(e=JSON.parse(r.responseText)).data.filePath,i=e.data.fileId;if(t.fileId=i,t.filePath=n,s.filedata.push(t),e&&"string"==typeof n){var a="http://"+backend.remote+"/"+e.data.filePath+"?pathtrs";o(a)}else l("Invalid JSON: "+r.responseText)}else l("HTTP Error: "+r.status)},(t=new FormData).append("file",e.blob(),e.filename()),t.append("busNo",s.busNo),r.send(t)},file_picker_callback:function(l,e,t){var n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("id","tinymceUpload"),document.body.appendChild(n),document.getElementById("tinymceUpload").click(),n.onchange=function(){var a=this.files[0],o=new FileReader;o.onload=function(){var e="blobid"+(new Date).getTime(),t=tinymce.activeEditor.editorUpload.blobCache,n=o.result.split(",")[1],i=t.create(e,a,n);t.add(i),l(i.blobUri(),{title:a.name})},o.readAsDataURL(a),document.body.removeChild(n)}},init_instance_callback:function(t){s.value&&t.setContent(s.value),s.hasInit=!0,t.on("Change KeyUp",function(e){s.hasChange=!0,s.$emit("input",t.getContent({format:"raw"})),s.content=t.getContent({format:"raw"})}),t.on("KeyDown",function(e){if("08"==e.keyCode){var t=/<img.*?(?:>|\/>)/gi,n=s.content.match(t);if(null!==n){for(var i=[],a=e.target.innerHTML.match(t)?e.target.innerHTML.match(t):[],o=0;o<a.length;o++)for(var l=0;l<n.length;l++)a[o]!==n[l]&&i.push(n[l]);var r=(1==n.length?n:i)[0].match(/src=['"]?([^'"]*)['"]?/i)[1];if(-1!==r.indexOf("?")){var c=r.replace(/^.*?\:\/\/[^\/]+/,"").slice(1),d=c.slice(0,c.indexOf("?"));yufp.service.request({url:backend.adminService+"/api/adminfileuploadinfo/deletericheditfile",method:"post",data:JSON.stringify({filePath:d}),callback:function(e,t,n){null!=n&&n&&(s.$message("删除成功!","提示"),console.info("删除成功"))}})}}}})},setup:function(e){e.addButton("h2",{title:"小标题",text:"小标题",onclick:function(){e.execCommand("mceToggleFormat",!1,"h2")},onPostRender:function(){var t=this;e.on("init",function(){e.formatter.formatChanged("h2",function(e){t.active(e)})})}}),e.addButton("p",{title:"正文",text:"正文",onclick:function(){e.execCommand("mceToggleFormat",!1,"p")},onPostRender:function(){var t=this;e.on("init",function(){e.formatter.formatChanged("p",function(e){t.active(e)})})}})}})},destroyed:function(){window.tinymce.get(this.id).destroy()}})}(Vue,yufp.$);