define(function(e,o){var i=function(){console.log(r,"clientId"),$("#imageCodePicture").attr("src",yufp.service.getUrl({url:backend.uaaService+"/api/codeImage?clientId="+r+"&t="+(new Date).getTime()}))},r=function(e,o){var a,s,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=[];if(o=o||n.length,e)for(a=0;a<e;a++)t[a]=n[0|Math.random()*o];else for(t[8]=t[13]=t[18]=t[23]="-",t[14]="4",a=0;a<36;a++)t[a]||(s=0|16*Math.random(),t[a]=n[19==a?3&s|8:s]);return t.join("")}(16,16);o.ready=function(e,o,a){var s=$("#username").val();$("#username").val("").focus().val(s),$("#imageCodePicture").click(function(){i()}),i();var n=new JSEncrypt;n.setPublicKey("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDAYwQ81rc1KW8tTYpxrLS3ArVxB40otmbWyXwgDQRkLsCuQKiq6KZgAM/8sJuI12S1JVOXnMu5d420vKFFS/+Ibz4TxqjhLmgownaguMTbAGBzIPvfN5lL52mDmm/CvKu2YPCFvZV8YulNTCexvuj7OiWRUXpAbaQqu5tPOjGytQIDAQAB");var t=function(){return""==$("#username").val()?($("#msg").text("请输入用户名!").show(),void $("#username").focus()):""==$("#password").val()?($("#msg").text("请输入密码!").show(),void $("#password").focus()):""==$("#imageCode").val()?($("#msg").text("请输入验证码!").show(),void $("#imageCode").focus()):($("#msg").hide(),void yufp.service.request({url:backend.uaaService+"/api/login/pubkey",method:"POST",callback:function(e,o,a){if(console.log(a,"responseresponse"),a&&0==a.code){var s={usercode:$("#username").val(),password:n.encrypt($("#password").val()),imageCode:$("#imageCode").val(),clientId:r,grant_type:"password"};console.log(s,"ddd"),yufp.service.request({needToken:!1,url:backend.uaaService+"/api/oauth/token/bak",method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",Authorization:"Basic d2ViX2FwcDo="},data:s,callback:function(e,o,a){if(console.log(e,o,a,"code, message, response"),a&&"900000"==a.code){var s=a&&a.message?a.message:"图形校验码验证失败！";$("#msg").text(s).show(),i(),$("#imageCode").val("")}else if(a&&0==a.code&&""!=a.rows)if("IS_INIT_PWD_N"===a.message)yufp.router.to("modifyUserPassword");else{var n=a&&a.rows;yufp.service.putToken(n),yufp.session.loadUserSession(function(){yufp.router.to("frame")})}else{s=a&&a.message?a.message:"登录失败，请联系系统管理员！";$("#msg").text(s).show(),i(),$("#imageCode").val("")}}})}else console.log("公钥获取失败")}}))};$("#submitBtn").click(function(){t()}),$("#username").keyup(function(){"13"==event.keyCode&&t()}),$("#password").keyup(function(){"13"==event.keyCode&&t()}),$("#imageCode").keyup(function(){"13"==event.keyCode&&t()}),$("#gyLoginA").click(function(){yufp.service.request({url:backend.uaaService+"/api/gy/ahref",method:"POST",data:{clientId:"0"},callback:function(e,o,a){a&&0==a.code&&$("#gyLoginA").attr("href",a.rows)}})}),$("#gyLoginBtn").click(function(){yufp.service.request({url:backend.uaaService+"/api/gy/ahref",method:"POST",data:{clientId:"0"},callback:function(e,o,a){a&&0==a.code&&window.open(a.rows)}})})}});