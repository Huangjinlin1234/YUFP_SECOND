define(["./custom/widgets/js/PrdIdInfoSelector.js"],function(e,t){t.ready=function(e,t,a){yufp.lookup.reg("ACT_STS,ACT_TYPE,ACT_REPAY_METHED,ACT_NEWCOMERS,PRD_VARIETY,ACT_CHANNEL_TYPE"),yufp.custom.vue({el:a.el,data:function(){var i=this;return{baseTab:"baseTab",dataUrl:backend.consoleService+"/api/activity/queryBaseAll",dataUrlActivityInfo:backend.consoleService+"/api/activity/queryDetailByActId",baseParams:{},baseParamsActivityInfo:{},expandCollapseName:["activityInfo"],queryFields:[{placeholder:"产品名称",field:"prdCode",type:"custom",is:"div-prdId-info-selector",params:{type:"code"}},{placeholder:"渠道",field:"prdType",type:"select",dataCode:"ACT_CHANNEL_TYPE"},{placeholder:"活动状态",field:"activityStatus",type:"select",dataCode:"ACT_STS"}],queryButtons:[{label:"查询",op:"submit",type:"primary",icon:"search",click:function(e,t){t&&i.$refs.reftable.remoteData(e)}},{label:"重置",op:"reset",type:"primary",icon:"yx-loop2"}],tableColumns:[{label:"活动Id",prop:"actId",sortable:!0,resizable:!0},{label:"产品",prop:"prdCode",sortable:!0,resizable:!0,dataCode:"PRD_VARIETY"},{label:"渠道",prop:"prdType",sortable:!0,resizable:!0,dataCode:"ACT_CHANNEL_TYPE"},{label:"起始日期",prop:"activityStartTime",sortable:!0,resizable:!0},{label:"终止日期",prop:"activityEndTime",sortable:!0,resizable:!0},{label:"优惠券类型",prop:"couponType",sortable:!0,resizable:!0,dataCode:"ACT_TYPE"},{label:"金额区间下限",prop:"applyAmtLow",sortable:!0,resizable:!0},{label:"金额区间上限",prop:"applyAmtUp",sortable:!0,resizable:!0},{label:"借款期限(月)",prop:"loanTerm",sortable:!0,resizable:!0},{label:"还款方式",prop:"repayMethod",sortable:!0,resizable:!0,dataCode:"ACT_REPAY_METHED"},{label:"是否新人专属",prop:"newcomersExclusive",sortable:!0,resizable:!0,dataCode:"ACT_NEWCOMERS"},{label:"活动状态",prop:"activityStatus",sortable:!0,resizable:!0,dataCode:"ACT_STS"},{label:"创建时间",prop:"createTime",sortable:!0,resizable:!0},{label:"创建人",prop:"createUser",sortable:!0,resizable:!0}],activityInfoFields:[{columnCount:3,fields:[{field:"prdCode",label:"产品",type:"select",dataCode:"PRD_VARIETY"},{field:"prdType",label:"渠道",type:"select",dataCode:"ACT_CHANNEL_TYPE"},{field:"activityStartTime",label:"起始日期",type:"date"},{field:"activityEndTime",label:"终止日期",type:"date"},{field:"couponType",label:"优惠券类型",type:"select",dataCode:"ACT_TYPE"},{field:"applyAmtLow",label:"金额区间下限"},{field:"applyAmtUp",label:"金额区间上限"},{field:"loanTerm",label:"借款期限(月)",type:"select"},{field:"repayMethod",label:"还款方式",type:"select",dataCode:"ACT_REPAY_METHED"},{field:"newcomersExclusive",label:"是否新人专属",type:"select",dataCode:"ACT_NEWCOMERS"},{field:"activityStatus",label:"活动状态",type:"select",dataCode:"ACT_STS",rules:[{required:!0,message:"必填项",trigger:"blur"}]}]}],activityInfoReftableColumns:[{label:"活动Id",prop:"actId",sortable:!0,resizable:!0},{label:"折扣活动Id",prop:"discountRateId",sortable:!0,resizable:!0},{label:"产品",prop:"prdCode",sortable:!0,resizable:!0,dataCode:"PRD_VARIETY"},{label:"渠道",prop:"prdType",sortable:!0,resizable:!0,dataCode:"ACT_CHANNEL_TYPE"},{label:"起始日期",prop:"activityStartTime",sortable:!0,resizable:!0},{label:"终止日期",prop:"activityEndTime",sortable:!0,resizable:!0},{label:"优惠券类型",prop:"couponType",sortable:!0,resizable:!0,dataCode:"ACT_TYPE"},{label:"借款利率",prop:"loanRate",sortable:!0,resizable:!0},{label:"折扣参数",prop:"discountRate",sortable:!0,resizable:!0},{label:"优惠券数量",prop:"couponCount",sortable:!0,resizable:!0},{label:"优惠券未占用数量",prop:"remainderCouponCount",sortable:!0,resizable:!0},{label:"金额区间下限",prop:"applyAmtLow",sortable:!0,resizable:!0},{label:"金额区间上限",prop:"applyAmtUp",sortable:!0,resizable:!0},{label:"借款期限(月)",prop:"loanTerm",sortable:!0,resizable:!0},{label:"还款方式",prop:"repayMethod",sortable:!0,resizable:!0,dataCode:"ACT_REPAY_METHED"},{label:"是否新人专属",prop:"newcomersExclusive",sortable:!0,resizable:!0,dataCode:"ACT_NEWCOMERS"},{label:"活动状态",prop:"activityStatus",sortable:!0,resizable:!0,dataCode:"ACT_STS"},{label:"创建日期",prop:"createTime",sortable:!0,resizable:!0},{label:"创建人",prop:"createUser",sortable:!0,resizable:!0},{label:"最后修改人",prop:"lastUpdateUser",sortable:!0,resizable:!0},{label:"最后修改时间",prop:"lastUpdateTime",sortable:!0,resizable:!0}],updateButtons:[{label:"取消",type:"primary",icon:"yx-undo2",hidden:!1,click:function(e){i.dialogVisible=!1}},{label:"保存",type:"primary",icon:"check",hidden:!1,click:function(e){var t=i.$refs.activityInfo.formModel;i.$confirm("请确认是否保存？","提示").then(function(e){"confirm"===e&&yufp.service.request({method:"PUT",url:backend.consoleService+"/api/activity/info",data:t,callback:function(e,t,a){0==e?1==a.rows?(i.$refs.activityInfo.resetFn(),i.$refs.reftable.remoteData(),i.$message("操作成功"),i.dialogVisible=!1):-2==a.rows?i.$message({message:"运营活动不允许修改为待生效！",type:"warning"}):-3==a.rows?i.$message({message:"运营活动已终止不允许修改！",type:"warning"}):-4==a.rows?i.$message({message:"该产品下已存在此渠道正在使用中的运营活动,请核查",type:"warning"}):i.$message({message:"操作失败！",type:"warning"}):i.$message({message:"操作失败！",type:"warning"})}})})}},{label:"返回",type:"primary",icon:"yx-undo2",hidden:!1,click:function(e){i.dialogVisible=!1}}],height:yufp.frame.size().height-103,dialogVisible:!1,formDisabled:!1,creditDisabled:!0,creditDialogVisible:!1,isEditOp:!0,viewTitle:yufp.lookup.find("CRUD_TYPE",!1)}},methods:{checkPermission:function(e){return!yufp.session.checkCtrl(e,a.menuId)},switchBankRel:function(){var e=this.$refs.activityInfo.formModel.cusBankRel;this.$nextTick(function(){return"02"==e||"04"==e})},switchStatus:function(e,t){var a=this;a.viewType=e,a.updateButtons[0].hidden=!t,a.updateButtons[1].hidden=!t,a.updateButtons[2].hidden=t,a.formDisabled=!t,a.dialogVisible=!0},switchParamStatusFalse:function(){var t=this;Array.prototype.slice.call(arguments).forEach(function(e){t.$refs.activityInfo.switch(e,"hidden",!1)}),t.$refs.activityInfo.rebuildFn()},modifyFn:function(){var t=this;1==this.$refs.reftable.selections.length?(this.switchStatus("EDIT",!0),t.isEditOp=!1,this.$nextTick(function(){t.$refs.activityInfo.resetFn(),t.switchParamStatusFalse("activityStatus"),this.$refs.activityInfo.switch("prdCode","disabled",!0),this.$refs.activityInfo.switch("prdType","disabled",!0),this.$refs.activityInfo.switch("activityStartTime","disabled",!0),this.$refs.activityInfo.switch("activityEndTime","disabled",!0),this.$refs.activityInfo.switch("couponType","disabled",!0),this.$refs.activityInfo.switch("discountRate","disabled",!0),this.$refs.activityInfo.switch("couponCount","disabled",!0),this.$refs.activityInfo.switch("applyAmtLow","disabled",!0),this.$refs.activityInfo.switch("applyAmtUp","disabled",!0),this.$refs.activityInfo.switch("loanTerm","disabled",!0),this.$refs.activityInfo.switch("repayMethod","disabled",!0),this.$refs.activityInfo.switch("newcomersExclusive","disabled",!0);var e=this.$refs.reftable.selections[0];yufp.extend(this.$refs.activityInfo.formModel,e)})):this.$message({message:"请先选择一条记录",type:"warning"})},infoFn:function(){if(1==this.$refs.reftable.selections.length){this.switchStatus("DETAIL",!1);var e=this;e.isEditOp=!0,e.updateButtons[2].hidden=!1;var t=e.$refs.reftable.selections[0];e.baseParamsActivityInfo={actId:t.actId},this.$nextTick(function(){e.$refs.activityInfo.resetFn(),e.$refs.activityInfoReftable.remoteData(e.baseParamsActivityInfo),yufp.util.copyObj(this.$refs.activityInfo.formModel,t)})}else this.$message({message:"请先选择一条记录",type:"warning"})}}})},t.onmessage=function(e,t){},t.destroy=function(e,t){}});