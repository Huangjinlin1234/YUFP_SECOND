define(["./custom/widgets/js/ContTempInfoSelector.js"],function(e,t){t.ready=function(e,t,a){yufp.lookup.reg("CRUD_TYPE,CONT_TEMP_TYPE,CONT_TYPE,COMMON_STATUS,STD_ZX_YES_NO");var d=yufp.custom.vue({el:a.el,data:function(){var a=this;return{dataUrl:backend.consoleService+"/api/cont/temp/gs",linkedDataUrl:backend.consoleService+"/api/cont/temp/info/contGLinked",baseParams:{},queryFields:[{placeholder:"模版组名称",field:"contGroupName",type:"input"},{placeholder:"机构法人码",field:"legalOrgCode",type:"input"},{placeholder:"创建时间范围",field:"createTimeBetween",type:"daterange",value:[]},{placeholder:"状态",field:"status",type:"select",dataCode:"COMMON_STATUS"}],queryButtons:[{label:"查询",op:"submit",type:"primary",icon:"search",click:function(e,t){t&&a.$refs.reftable.remoteData(e)}},{label:"重置",op:"reset",type:"primary",icon:"yx-loop2"}],tableColumns:[{label:"模版组名称",prop:"contGroupName",sortable:!0,resizable:!0},{label:"状态",prop:"status",resizable:!0,dataCode:"COMMON_STATUS"},{label:"机构法人代码",prop:"legalOrgCode",resizable:!0},{label:"创建人",prop:"createUser",resizable:!0},{label:"创建日期",prop:"createTime",resizable:!0}],updateLoading:!1,updateFields:[{columnCount:1,fields:[{field:"contGroupName",label:"模版组名称",rules:[{required:!0,message:"模版组名称是必填项"},{max:300,message:"最大长度为300"}]}]},{columnCount:2,fields:[{field:"contGroupId",label:"合同组ID",placeholder:"系统自动生成",disabled:!0,hidden:!0},{field:"status",label:"状态",type:"select",dataCode:"COMMON_STATUS",hidden:!0,rules:[{required:!0,message:"必填项"}]},{field:"legalOrgCode",label:"法人机构码",hidden:!0},{field:"createUser",label:"创建人",hidden:!0},{field:"createTime",label:"创建日期",hidden:!0},{field:"lastUpdateUser",label:"最后更新人",hidden:!0},{field:"lastUpdateTime",label:"最后更新时间",hidden:!0}]}],height:yufp.frame.size().height-103,dialogVisible:!1,formDisabled:!1,viewType:"DETAIL",viewTitle:yufp.lookup.find("CRUD_TYPE",!1),expandCollapseName:["base"],contTempInfo:{dataUrl:backend.consoleService+"/api/cont/temp/info/notlink/enable",queryFields:[{placeholder:"合同模板名称",field:"contTempName",type:"input"},{placeholder:"模板种类",field:"contTempType",type:"select",dataCode:"CONT_TEMP_TYPE"},{placeholder:"合同类型",field:"contType",type:"select",dataCode:"CONT_TYPE"}],queryButtons:[{label:"查询",op:"submit",type:"primary",icon:"search",click:function(e,t){t&&(e.contGroupId=a.$refs.reform.formModel.contGroupId,a.$refs.linktable.remoteData(e))}},{label:"重置",op:"reset",type:"primary",icon:"yx-loop2"}],tableColumns:[{label:"合同模板名称",prop:"contTempName",sortable:!0,resizable:!0},{label:"模板种类",prop:"contTempType",resizable:!0,dataCode:"CONT_TEMP_TYPE"},{label:"模板文件名",prop:"contTempPath",resizable:!0},{label:"合同类型",prop:"contType",resizable:!0,dataCode:"CONT_TYPE"},{label:"是否最高额合同",prop:"maxLmtContFlag",resizable:!0,dataCode:"STD_ZX_YES_NO"},{label:"状态",prop:"status",resizable:!0,dataCode:"COMMON_STATUS"}],updateLoading:!1},linkedVisible:!1,addLinkVisible:!1,contTempGBtnsVisible:!0}},methods:{checkPermission:function(e){return!yufp.session.checkCtrl(e,a.menuId)},cancelFn:function(){this.dialogVisible=!1},submitClassfyCfgFn:function(){var i=this,e=i.$refs.reform.formModel,t=!1;i.$refs.reform.validate(function(e){t=e}),t&&(d.updateLoading=!0,yufp.service.request({method:"PUT",url:backend.consoleService+"/api/cont/temp/g/submit",data:e,callback:function(e,t,a){d.updateLoading=!1;var s=a.data;0==e&&0<=s?(i.$refs.reftable.remoteData(),i.$message("操作成功"),i.dialogVisible=!1):i.$message({message:a.message,type:"warning"})}}))},saveClassfyCfgFn:function(){var s=this,e=s.$refs.reform.formModel,t=!1;if(s.$refs.reform.validate(function(e){t=e}),t){var a="";"EDIT"==s.viewType?a="PUT":"ADD"==s.viewType&&(a="POST"),d.updateLoading=!0,yufp.service.request({method:a,url:backend.consoleService+"/api/cont/temp/g",data:e,callback:function(e,t,a){d.updateLoading=!1,0==e?(s.$refs.reftable.remoteData(),"ADD"==s.viewType?a&&a.data?(s.$message("操作成功"),yufp.extend(s.$refs.reform.formModel,a.data),s.$refs.linkedtable.remoteData(a.data),s.viewType="EDIT"):s.$message("操作失败"):(s.$message("操作成功"),s.dialogVisible=!1)):s.$message("操作失败")}})}},switchStatus:function(e,t){this.updateLoading=!1,this.linkedVisible="ADD"!=e;var a=this;a.viewType=e,a.formDisabled=!t,a.dialogVisible=!0},switchParamStatus:function(){var e="DETAIL"!=this.viewType;this.$refs.reform.switch("status","hidden",e),this.$refs.reform.switch("legalOrgCode","hidden",e),this.$refs.reform.switch("createTime","hidden",e),this.$refs.reform.switch("createUser","hidden",e),this.$refs.reform.switch("lastUpdateUser","hidden",e),this.$refs.reform.switch("lastUpdateTime","hidden",e),this.$refs.reform.rebuildFn()},addFn:function(){this.switchStatus("ADD",!0),this.$nextTick(function(){this.switchParamStatus(),this.$refs.reform.resetFn()})},modifyFn:function(){if(1==this.$refs.reftable.selections.length){var e=this.$refs.reftable.selections[0];"0"==e.status?(this.switchStatus("EDIT",!0),this.$nextTick(function(){this.switchParamStatus(),this.contTempGBtnsVisible=!0,yufp.extend(this.$refs.reform.formModel,e),d.$refs.linkedtable.remoteData(e)})):this.$message({message:"只能修改待生效的合同模版",type:"warning"})}else this.$message({message:"请先选择一条记录",type:"warning"})},infoFn:function(){1==this.$refs.reftable.selections.length?(this.switchStatus("DETAIL",!1),this.$nextTick(function(){this.switchParamStatus(),this.contTempGBtnsVisible=!1;var e=this.$refs.reftable.selections[0];yufp.extend(this.$refs.reform.formModel,e),d.$refs.linkedtable.remoteData(e)})):this.$message({message:"请先选择一条记录",type:"warning"})},deleteFn:function(){var s=this,e=s.$refs.reftable.selections;if(e.length<1)s.$message({message:"请先选择一条记录",type:"warning"});else{var t=e[0];"0"==t.status?this.$confirm("是否删除合同模版组？","提示").then(function(){yufp.service.request({method:"DELETE",url:backend.consoleService+"/api/cont/temp/g",data:{contGroupId:t.contGroupId},callback:function(e,t,a){0==e?a&&-2==a.data?s.$message({message:a.message,type:"warning"}):(s.$refs.reftable.remoteData(),s.$message("操作成功")):s.$message("操作失败")}})}):s.$message({message:"只能删除待生效的合同模版!",type:"warning"})}},exportFn:function(){yufp.util.exportExcelByTable({fileName:"下载文件",importType:"service",ref:this.$refs.reftable,url:"",param:{}})},disableFn:function(){if(1==d.$refs.reftable.selections.length){var e=d.$refs.reftable.selections[0];"1"==e.status?this.$confirm("是否失效合同模版组？","提示").then(function(){yufp.service.request({method:"POST",url:backend.consoleService+"/api/cont/temp/g/disable",data:{contGroupId:e.contGroupId},callback:function(e,t,a){0==e?a.data<0?d.$message({message:a.message,type:"warning"}):(d.$refs.reftable.remoteData(),d.$message("操作成功")):d.$message("操作失败")}})}):d.$message({message:"只有生效状态才能失效",type:"warning"})}else d.$message({message:"请先选择一条记录",type:"warning"})},addLinkFn:function(){this.addLinkVisible=!0;var t=this.$refs.reform.formModel.contGroupId;this.$nextTick(function(){var e={};e.contGroupId=t,this.$refs.linktable.remoteData(e),this.$refs.linkquetab.$children[0].resetFields()})},deleteLinkFn:function(){var t;1==d.$refs.linkedtable.selections.length?(t=d.$refs.linkedtable.selections[0],this.$confirm("是否删除关联合同模版？","提示").then(function(){var e=d.$refs.reform.formModel.contGroupId;yufp.service.request({method:"DELETE",url:backend.consoleService+"/api/cont/temp/rel/g",data:{contTempId:t.contTempId,contGroupId:e},callback:function(e,t,a){0==e?(d.$refs.linkedtable.remoteData(),d.$message("操作成功")):d.$message("操作失败")}})})):d.$message({message:"请先选择一条记录",type:"warning"})},selectFn:function(){var e=this.$refs.reform.formModel.contGroupId,t=this.$refs.linktable.selections;if(0!=t.length){for(var a,s,i=0;i<t.length;i++){a=t[i];for(var r=0;r<t.length;r++)if(s=t[r],a.contTempId!=s.contTempId&&a.contTempType==s.contTempType&&a.contType==s.contType&&a.maxLmtContFlag==s.maxLmtContFlag)return void this.$message({message:"不能选择模版种类, 合同类型, 是否最高额合同三种纬度相同的合同模板!",type:"warning"})}for(var n=[],o=0;o<t.length;o++)n.push(t[o].contTempId);var l={contGroupId:e,contTempIdArr:n.join(",")};d.contTempInfo.updateLoading=!0,yufp.service.request({method:"POST",url:backend.consoleService+"/api/cont/temp/rel/g",data:l,callback:function(e,t,a){if(d.contTempInfo.updateLoading=!1,0==e)if(a.data<0)d.$message({message:a.message,type:"warning"});else{var s;s=d.$refs.reform.formModel,d.$refs.linkedtable.remoteData(s),d.$message("操作成功"),d.addLinkVisible=!1}else _self.$message("操作失败")}})}else this.$message({message:"请选择至少一个合同模版",type:"warning"})}}})},t.onmessage=function(e,t){},t.destroy=function(e,t){}});