define(["./custom/widgets/js/OrgDistribution.js"],function(e,i){i.ready=function(e,i,t){yufp.lookup.reg("CRUD_TYPE,ROLE_TYPE,STD_ZX_SEX,USER_STATUS"),yufp.custom.vue({el:t.el,data:function(){var n=this;return{dataUrl:backend.consoleService+"/api/s/rolesBaseOrgs",dataUrlView:backend.consoleService+"/api/s/roles/user",baseParams:{},baseParamsView:{},queryFields:[{placeholder:"角色代码",field:"roleCode",type:"input"},{placeholder:"角色名称",field:"roleName",type:"input"},{placeholder:"角色类型",field:"roleType",type:"select",dataCode:"ROLE_TYPE",hidden:!0}],queryButtons:[{label:"查询",op:"submit",type:"primary",icon:"search",click:function(e,i){i&&n.$refs.reftable.remoteData(e)}},{label:"重置",op:"reset",type:"primary",icon:"yx-loop2"}],tableColumns:[{label:"角色代码",prop:"roleCode"},{label:"角色名称",prop:"roleName",sortable:!0,resizable:!0},{label:"法人机构代码",prop:"legalOrgCode",width:200,hidden:!0},{label:"角色类型",prop:"roleType",dataCode:"ROLE_TYPE"},{label:"创建人",prop:"createUser",hidden:!0},{label:"创建时间",prop:"createTime",type:"date",hidden:!0}],updateFields:[{columnCount:2,fields:[{field:"roleCode",label:"角色码",disabled:!0,placeholder:"系统自动生成"},{field:"roleName",label:"角色名称",rules:[{required:!0,message:"角色名称是必填项",trigger:"blur"},{max:60,message:"最大长度为60"}]},{field:"roleType",label:"角色类型",type:"select",dataCode:"ROLE_TYPE",disabled:!0,value:"001",hidden:!0},{field:"orgCode",label:"适用机构",type:"custom",is:"div-org-distribution",placeholder:"机构代码",rules:[{required:!0,message:"适用机构是必填项",trigger:"blur"}]},{field:"legalOrgCode",label:"法人机构代码",type:"custom",is:"div-org-selector",params:{placeholder:"法人机构代码"},hidden:!0},{field:"orderId",label:"排序字段",rules:[{validator:yufp.validator.number,message:"排序字段必须为数字值"}],hidden:!0},{field:"createTime",label:"创建日期",hidden:!0},{field:"createUser",label:"创建人",hidden:!0},{field:"lastUpdateTime",label:"最后修改时间",hidden:!0},{field:"lastUpdateUser",label:"最后修改人",hidden:!0}]},{columnCount:1,fields:[{field:"roleRmk",label:"备注",type:"textarea",rules:[{max:100,message:"最大长度为100"}]}]}],updateButtons:[{label:"保存",type:"primary",icon:"check",hidden:!1,click:function(e){var i=!1;if(n.$refs.reform.validate(function(e){i=e}),i){var t="";"EDIT"==n.viewType?t="PUT":"ADD"==n.viewType&&(t="POST");var s="保存后立即生效，请确认是否继续！";if(null==e.orgCode||""==e.orgCode)s="【"+e.roleName+"】角色默认为全行适用，保存后可点击“设置适用机构”修改适用机构，"+s;else{var r=e.orgCode,a="";if(-1!=r.indexOf(","))for(var l=r.split(","),o=0;o<l.length;o++)o==l.length-1?a+=l[o]:(a=a+l[o]+",",0!=o&&(o+1)%9==0&&(a+="\n"));else a=r;s="角色【"+e.roleName+"】将适用于机构【"+a+"】及它的上级机构。"+s}n.$confirm(s,"提示").then(function(){yufp.service.request({method:t,url:backend.consoleService+"/api/s/role",data:e,callback:function(e,i,t){0==e&&1==t.rows?(n.$refs.reftable.remoteData(),n.$message("操作成功"),n.dialogVisible=!1):-11==t.rows?n.$message("该角色名称信息已存在！"):n.$message("操作失败")}})})}}},{label:"取消",type:"primary",icon:"yx-undo2",hidden:!1,click:function(e){n.dialogVisible=!1}},{label:"返回",type:"primary",icon:"yx-undo2",hidden:!1,click:function(e){n.dialogVisible=!1}}],tableColumnsView:[{label:"角色代码",prop:"roleCode"},{label:"用户代码",prop:"userCode",sortable:!0,resizable:!0},{label:"用户姓名",prop:"userName",sortable:!0,resizable:!0},{label:"机构名称",prop:"orgName",sortable:!0,resizable:!0},{label:"联系电话",prop:"telPhone",sortable:!0,resizable:!0},{label:"性别",prop:"sex",sortable:!0,resizable:!0,dataCode:"STD_ZX_SEX"},{label:"状态",prop:"status",sortable:!0,resizable:!0,dataCode:"USER_STATUS"}],height:yufp.frame.size().height-103,dialogVisible:!1,formDisabled:!1,dialogVisibleView:!1,viewType:"DETAIL",viewTitle:yufp.lookup.find("CRUD_TYPE",!1),setOrg:[],orgData:[],orgDialogVisible:!1}},methods:{checkPermission:function(e){return!yufp.session.checkCtrl(e,t.menuId)},switchStatus:function(e,i){var t=this;t.viewType=e,t.updateButtons[0].hidden=!i,t.updateButtons[1].hidden=!i,t.updateButtons[2].hidden=i,t.formDisabled=!i,t.dialogVisible=!0},switchParamStatus:function(){var e="DETAIL"!=this.viewType;this.$refs.reform.switch("createTime","hidden",e),this.$refs.reform.switch("createUser","hidden",e),this.$refs.reform.switch("lastUpdateUser","hidden",e),this.$refs.reform.switch("lastUpdateTime","hidden",e),this.$refs.reform.rebuildFn()},addFn:function(){this.switchStatus("ADD",!0),this.$nextTick(function(){this.switchParamStatus(),this.$refs.reform.resetFn()})},modifyFn:function(){1==this.$refs.reftable.selections.length?(this.switchStatus("EDIT",!0),this.$nextTick(function(){this.switchParamStatus();var e=this.$refs.reftable.selections[0];yufp.extend(this.$refs.reform.formModel,e)})):this.$message({message:"请先选择一条记录",type:"warning"})},infoFn:function(){1==this.$refs.reftable.selections.length?(this.switchStatus("DETAIL",!1),this.$nextTick(function(){this.switchParamStatus(),yufp.extend(this.$refs.reform.formModel,this.$refs.reftable.selections[0])})):this.$message({message:"请先选择一条记录",type:"warning"})},viewSuerFn:function(){var e=this;1==this.$refs.reftable.selections.length?(this.dialogVisibleView=!0,this.dialogVisible=!1,e.baseParamsView={roleCode:e.$refs.reftable.selections[0].roleCode},this.$nextTick(function(){e.$refs.viewReftable.remoteData(e.baseParamsView)})):this.$message({message:"请先选择一条记录",type:"warning"})},deleteFn:function(){var s=this;if(s.$refs.reftable.selections.length<1)s.$message({message:"请先选择一条记录",type:"warning"});else{var r=s.$refs.reftable.selections[0];s.$confirm("是否删除角色【"+r.roleName+"】？","提示",{type:"warning"}).then(function(){yufp.service.request({method:"POST",url:backend.consoleService+"/api/s/role/bind/user",data:{roleCode:r.roleCode},callback:function(e,i,t){0==e&&t?0<t.rows?s.$message({message:"角色【"+r.roleName+"】与用户存在关联关系，无法删除！",type:"warning"}):s.confirmDelteFn(r.roleCode):s.$message("操作失败")}})})}},confirmDelteFn:function(e){var s=this;yufp.service.request({method:"DELETE",url:backend.consoleService+"/api/s/role",data:{roleCode:e},callback:function(e,i,t){0==e?(s.$refs.reftable.remoteData(),s.$message("操作成功")):s.$message("操作失败")}})},returnView:function(){this.dialogVisibleView=!1},exportFn:function(){yufp.util.exportExcelByTable({fileName:"下载文件",importType:"service",ref:this.$refs.reftable,url:"",param:{}})}},mounted:function(){this.$nextTick(function(){this.$refs.queryform.fm.roleCode=i.key,i.children=this})}})},i.onmessage=function(e,i){},i.destroy=function(e,i){}});