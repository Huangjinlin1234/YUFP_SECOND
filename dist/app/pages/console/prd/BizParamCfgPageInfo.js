define(["./custom/widgets/js/BizParamCfgPageInfoSelector.js","./libs/js-xlsx/xlsx.full.min.js"],function(e,r){r.ready=function(e,r,a){yufp.lookup.reg("CRUD_TYPE,RPOVINCE_FLAG,STD_ZX_YES_NO,COMMON_STATUS,Date");var t=yufp.custom.vue({el:a.el,data:function(){var s=this;return{dataUrl:backend.consoleService+"/api/biz/param/cfgs",childDataUrl:backend.consoleService+"/api/s/dic/biz/bid",baseParams:{},queryFields:[{placeholder:"配置ID",field:"cfgId",type:"input"},{placeholder:"法人机构代码",field:"legalOrgCode",type:"input"},{placeholder:"配置状态",field:"status",type:"select",dataCode:"COMMON_STATUS"},{placeholder:"生效日期",field:"effictiveDate",type:"date"},{placeholder:"创建人",field:"createUser",type:"input"}],queryButtons:[{label:"查询",op:"submit",type:"primary",icon:"search",click:function(e,r){r&&s.$refs.reftable.remoteData(e)}},{label:"重置",op:"reset",type:"primary",icon:"yx-loop2"}],tableColumns:[{label:"配置ID",prop:"cfgId",sortable:!0,resizable:!0},{label:"法人机构代码",prop:"legalOrgCode",sortable:!0,resizable:!0},{label:"省级定义标志",prop:"rpovinceFlag",type:"select",dataCode:"STD_ZX_YES_NO",sortable:!0,resizable:!0},{label:"禁入行业",prop:"forbidIndus",width:"120px",sortable:!0,resizable:!0,template:function(){return'<template scope="scope">                                    <a href="javascript:void(0);" style="text-decoration:underline;" @click="_$event(\'custom-row-click\', scope)">{{ "查看禁入行业详情" }}</a>                                </template>'}},{label:"征信查询有效期（天）",prop:"crdExpiryDt",sortable:!0,resizable:!0},{label:"贷后征信查询期限（天）",prop:"loanAfterTrem",sortable:!0,resizable:!0},{label:"是否签订额度协议",prop:"signLmtCont",sortable:!0,resizable:!0,type:"select",dataCode:"STD_ZX_YES_NO"},{label:"批复有效期（天）",prop:"apprExpiryDt",sortable:!0,resizable:!0},{label:"检查报告生成周期（月）",prop:"chkRptCrtPeriod",sortable:!0,resizable:!0},{label:"定期检查任务生成周期（月）",prop:"regChkCrtPeriod",sortable:!0,resizable:!0},{label:"授信机构数量上限（家）",prop:"crdOrgUpperLmt",sortable:!0,resizable:!0},{label:"授信总限额（万）",prop:"crdLmtAmt",sortable:!0,resizable:!0},{label:"单个法人机构授信限额（万）",prop:"orgLmtAmt",sortable:!0,resizable:!0},{label:"支用有效期（天）",prop:"tphChkExpiryDt",sortable:!0,resizable:!0},{label:"电核限额（元）",prop:"tphChkLmtAmt",sortable:!0,resizable:!0},{label:"配置状态",prop:"status",type:"select",dataCode:"COMMON_STATUS",sortable:!0,resizable:!0},{label:"提额间隔天数/提额批复有效期（天）",prop:"amtIntervalCount",sortable:!0,resizable:!0},{label:"提额系数",prop:"amtCoefficient",sortable:!0,resizable:!0},{label:"提额额度最小值（元）",prop:"amtLmtMin",sortable:!0,resizable:!0}],bizPparams:{forbidIndus:""},updateFields:[{columnCount:2,fields:[{field:"forbidIndusArr",label:"禁入行业",hidden:!1,type:"custom",params:s,value:[],is:"biz-param-cfg-selector"},{field:"crdExpiryDt",label:"征信查询有效期（天）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,type:"number",message:"数字",trigger:"blur"}]},{field:"loanAfterTrem",label:"贷后征信查询期限（天）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,type:"number",message:"数字",trigger:"blur"}]},{field:"signLmtCont",label:"是否签订额度协议",hidden:!0,type:"select",dataCode:"STD_ZX_YES_NO",rules:[{required:!0,message:"必填项",trigger:"blur"}]},{field:"apprExpiryDt",label:"批复有效期（天）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,message:"数字",trigger:"blur"}]},{field:"chkRptCrtPeriod",label:"检查报告生成周期（月）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,message:"数字",trigger:"blur"}]},{field:"regChkCrtPeriod",label:"定期检查任务生成周期（月）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,message:"数字",trigger:"blur"}]},{field:"crdOrgUpperLmt",label:"授信机构数量上限（家）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,type:"number",message:"数字",trigger:"blur"}]},{field:"crdLmtAmt",label:"授信总限额（万）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.gZero,type:"number",message:"数字",trigger:"blur"}]},{field:"orgLmtAmt",label:"单个法人机构授信限额（万）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.gZero,message:"数字",trigger:"blur"}]},{field:"tphChkExpiryDt",label:"支用有效期（天）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,message:"数字",trigger:"blur"}]},{field:"amtIntervalCount",label:"提额间隔天数/提额批复有效期（天）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.number,type:"number",message:"数字",trigger:"blur"}]},{field:"tphChkLmtAmt",label:"电核限额（元）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.gZero,message:"数字",trigger:"blur"}]},{field:"amtCoefficient",label:"提额系数",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.gZero,message:"数字",trigger:"blur"}]},{field:"amtLmtMin",label:"提额额度最小值（元）",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:yufp.validator.gZero,message:"数字",trigger:"blur"}]},{field:"status",label:"配置状态",type:"select",dataCode:"COMMON_STATUS"},{field:"effictiveDate",label:"生效日期"},{field:"expiryDate",label:"失效日期"},{field:"createUser",label:"创建人",hidden:!0},{field:"createTime",label:"创建时间",type:"select",dataCode:"Date",hidden:!0},{field:"lastUpdateUser",label:"最后修改人",hidden:!0},{field:"lastUpdateTime",label:"最后修改日期",type:"select",dataCode:"Date",hidden:!0}]}],updateButtons:[{label:"保存",type:"primary",icon:"check",hidden:!1,click:function(e){var r=!1;if(s.$refs.reform.validate(function(e){r=e}),r)if(function(e,r){if(""==e||""==r)return!0;e=parseInt(e);return(r=parseInt(r))<=e}(s.$refs.reform.formModel.crdLmtAmt,s.$refs.reform.formModel.orgLmtAmt)){var a;s.$refs.reform.formModel.forbidIndusArr=null==(a=s.$refs.reform.formModel.forbidIndusArr)||""==a?a=[]:a;var t="";"EDIT"==s.viewType?t="PUT":"ADD"==s.viewType&&(t="POST"),s.$refs.reform.formModel.crdLmtAmt=s.toPercent(e.crdLmtAmt),s.$refs.reform.formModel.orgLmtAmt=s.toPercent(e.orgLmtAmt),s.$refs.reform.formModel.tphChkLmtAmt=s.toPercent(e.tphChkLmtAmt),s.$refs.reform.formModel.amtLmtMin=s.toPercent(e.amtLmtMin),yufp.service.request({method:t,url:backend.consoleService+"/api/biz/param/cfg",data:e,callback:function(e,r,a){0==e?a&&-2==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-3==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-4==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-5==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-6==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-7==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-8==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-9==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-10==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-11==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-12==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-13==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-14==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-15==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-16==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):a&&-1==a.data?(s.$refs.reftable.remoteData(),s.$message({message:a.message,type:"warning"})):(s.$message("操作成功"),s.dialogVisible=!1,s.$refs.reftable.remoteData()):s.$message("操作失败")}})}else s.$message({message:"单个法人机构授信限额要小于或者等于授信总限额！",type:"warning"})}},{label:"返回",type:"primary",icon:"yx-undo2",hidden:!1,click:function(e){s.dialogVisible=!1}}],height:yufp.frame.size().height-103,dialogVisible:!1,childDialogVisible:!1,formDisabled:!1,viewType:"DETAIL",viewTitle:yufp.lookup.find("CRUD_TYPE",!1),forbidValueQueryFields:[{placeholder:"禁入行业名称",field:"cnname",type:"input"},{placeholder:"禁入行业编码",field:"enname",type:"input"}],forbidValueQueryButtons:[{label:"查询",op:"submit",type:"primary",icon:"search",click:function(e,r){r&&s.$refs.forbidValueRetable.remoteData(e)}},{label:"重置",op:"reset",type:"primary",icon:"yx-loop2"}],forbidValue:{tableColumns:[{label:"禁入行业编码",prop:"enname",width:"250px",sortable:!0,resizable:!0},{label:"禁入行业名称",prop:"cnname",sortable:!0,resizable:!0}]},forbidArr:[]}},methods:{customRowClick:function(e){var r=this;this.childDialogVisible=!0,this.$nextTick(function(){r.$refs.forbidValueRetable.remoteData({valueId:e.row.forbidIndus})})},checkPermission:function(e){return!yufp.session.checkCtrl(e,a.menuId)},switchStatus:function(e,r){var a=this;a.viewType=e,a.updateButtons[0].hidden=!r,a.formDisabled=!r,a.dialogVisible=!0},switchParamStatus:function(){var e=this,r="DETAIL"!=this.viewType;e.$refs.reform.switch("createUser","hidden",r),e.$refs.reform.switch("createTime","hidden",r),e.$refs.reform.switch("lastUpdateUser","hidden",r),e.$refs.reform.switch("lastUpdateTime","hidden",r),e.$refs.reform.switch("status","hidden",r),e.$refs.reform.switch("effictiveDate","hidden",r),e.$refs.reform.switch("expiryDate","hidden",r)},addFn:function(){var e=this;this.bizPparams.forbidIndus="",e.switchStatus("ADD",!0),e.$nextTick(function(){t.switchParamStatus(),e.$refs.reform.switch("forbidIndusArr","hidden",!1),e.$refs.reform.switch("signLmtCont","hidden",!0),e.$refs.reform.resetFn(),e.$refs.reform.formModel.tphChkExpiryDt="1095"})},modifyFn:function(){var e=this;if(1==this.$refs.reftable.selections.length){var r=this.$refs.reftable.selections[0],a=yufp.session.legalOrg.orgCode;if(r.legalOrgCode==a)if("2"!=r.status){e.switchStatus("EDIT",!0);r=this.$refs.reftable.selections[0];e.$nextTick(function(){t.switchParamStatus(),e.$refs.reform.switch("forbidIndusArr","hidden",!1),e.$refs.reform.switch("signLmtCont","hidden",!0),e.$refs.reform.resetFn(),yufp.extend(this.$refs.reform.formModel,r),this.bizPparams.forbidIndus=r.forbidIndus})}else this.$message({message:"已失效配置，不能修改！",type:"warning"});else this.$message({message:"不是本法人机构配置，不能修改！",type:"warning"})}else this.$message({message:"请先选择一条记录",type:"warning"})},infoFn:function(){if(1==this.$refs.reftable.selections.length){var e=this.$refs.reftable.selections[0];yufp.session.legalOrg.orgCode;this.switchStatus("DETAIL",!1),this.$nextTick(function(){t.switchParamStatus(),this.$refs.reform.switch("forbidIndusArr","hidden",!0),this.$refs.reform.switch("signLmtCont","hidden",!1),this.$refs.reform.resetFn(),yufp.extend(this.$refs.reform.formModel,e)})}else this.$message({message:"请先选择一条记录",type:"warning"})},disableFn:function(){var t=this,e=t.$refs.reftable.selections;if(e.length<1)t.$message({message:"请先选择一条记录",type:"warning"});else{var r=this.$refs.reftable.selections[0],a=yufp.session.legalOrg.orgCode;if(r.legalOrgCode==a){for(var s=e.length,i=[],l=0;l<s;l++)i.push(e[l].cfgId);"0"!=r.status&&"2"!=r.status?this.$confirm("是否失效配置？","提示",{type:"warning"}).then(function(){t.$refs.reftable.selections[0].cfgId;r.status="2",yufp.service.request({method:"PUT",url:backend.consoleService+"/api/biz/param/cfg/status",data:r,callback:function(e,r,a){0==e?a&&-2==a.data?t.$message({message:a.message,type:"warning"}):(t.$refs.reftable.remoteData(a.data),t.$message("操作成功")):t.$message("操作失败")}})}):this.$message({message:"只有生效才能设置失效！",type:"warning"})}else this.$message({message:"不是本法人机构配置，不能失效！",type:"warning"})}},toPercent:function(e){return e=null!=e&&""!=e?parseFloat(e+"").toFixed(2):""}}})},r.onmessage=function(e,r){},r.destroy=function(e,r){}});