define(function(e,s){s.ready=function(e,s,r){yufp.custom.vue({el:r.el,data:function(){var o=this,e=function(e,a,d){a&&a==s&&d(new Error("修改的密码不能和原密码一致！"));var s=o.$refs.myform.formModel.oldPassword,r=(o.$refs.myform.formModel.newPassword,yufp.session.userCode);yufp.service.request({method:"POST",url:backend.consoleService+"/api/s/user/"+r,data:r,callback:function(e,s,r){if(0==e&&r&&0==r.code&&"Y"!=r.rows.isTeller){var o=/((?=.*[a-zA-Z])(?=.*\d)|(?=.*[a-zA-Z])(?=.*[~!@#$%^&*])|(?=.*\d)(?=.*[~!@#$%^&*])|(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*]))[a-zA-Z\d~!@#$%^&*]{5,16}/;a&&o.test(a)?d():a&&!o.test(a)?d(new Error("密码必须包含数字、字母或特殊字符(~!@#$%^&*)的至少两种")):d()}}})};return{updateFields:[{columnCount:1,fields:[{field:"oldPassword",label:"原密码",placeholder:"请输入原密码",maxLength:16,type:"password",rules:[{required:!0,message:"必输项",trigger:"blur"}]},{field:"newPassword",label:"新密码",placeholder:"请输入新密码",maxLength:16,type:"password",rules:[{required:!0,message:"必输项",trigger:"blur"},{validator:yufp.validator.countLength,max:16,min:5,message:"长度必须在5到16个字符之间"},{validator:e}]},{field:"passwords",label:"确认密码",placeholder:"请再次输入新密码",maxLength:16,type:"password",rules:[{required:!0,message:"必输项",trigger:"blur"},{validator:yufp.validator.countLength,max:16,min:5,message:"长度必须在5到16个字符之间"},{validator:function(e,s,r){s&&""!=s?o.$refs.myform.formModel.newPassword==s?r():r("两次密码不一致，请重新输入"):r()}},{validator:e}]}]}],updateButtons:[{label:"提交",type:"primary",op:"submit",click:function(e,s){s&&o.modifyPassword(e)}},{label:"重置",type:"primary",op:"reset",click:function(e){o.$refs.myform.resetFields()}}]}},methods:{modifyPassword:function(e){var a,d=this;yufp.service.request({url:backend.uaaService+"/api/login/pubkey",method:"POST",callback:function(e,s,r){if(r&&0==r.code){a=r.rows;var o={usercode:yufp.session.userId,password:sm2Encrypt(d.$refs.myform.formModel.oldPassword,a,1),newPassword:sm2Encrypt(d.$refs.myform.formModel.newPassword,a,1)};yufp.service.request({method:"POST",url:backend.uaaService+"/api/account/modifyUserPwd",data:o,callback:function(e,s,r){0==e&&r&&0==r.code?(d.$message({type:"success",message:"修改用户密码操作成功！"}),d.$refs.myform.resetFields()):r&&r.message?d.$message({type:"error",message:r.message}):d.$message({type:"error",message:"修改用户密码操作失败！"})}})}else console.log("公钥获取失败")}})},resetFn:function(e){this.$refs.myform.resetFields()}}})},s.onmessage=function(e,s){},s.destroy=function(e,s){}});